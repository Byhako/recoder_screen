<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>
  <style>
    body {
      height: 100vh;
      background: #222;
      display: flex;
      flex-direction: column;
      gap: 30px;
      align-items: center;
      justify-content: center;
    }
    button {
      width: 180px;
      height: 50px;
      display: flex;
      justify-content: center;
      align-items: center;
      font-size: 22px;
      padding-right: 33px;
      cursor: pointer;
    }
    span {
      margin-left: 20px;
    }
  </style>
</head>
<body>
  <button id="record">
    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-player-record-filled" width="32" height="32" viewBox="0 0 24 24" stroke-width="1.5" stroke="#ff4500" fill="none" stroke-linecap="round" stroke-linejoin="round">
    <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
    <path d="M8 5.072a8 8 0 1 1 -3.995 7.213l-.005 -.285l.005 -.285a8 8 0 0 1 3.995 -6.643z" stroke-width="0" fill="#ff4500" />
  </svg>
    <span>Grabar</span>
  </button>
  <button id="stop">
    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-square-filled" width="24" height="24" viewBox="0 0 24 24" stroke-width="1.5" stroke="#222" fill="none" stroke-linecap="round" stroke-linejoin="round">
      <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
      <path d="M19 2h-14a3 3 0 0 0 -3 3v14a3 3 0 0 0 3 3h14a3 3 0 0 0 3 -3v-14a3 3 0 0 0 -3 -3z" stroke-width="0" fill="#222" />
    </svg>
    <span>Parar</span>
  </button>

  <script>
    const record = document.getElementById('record')
    const stop = document.getElementById('stop')

    record.addEventListener('click', async () => {
      const media = await navigator.mediaDevices.getDisplayMedia({
        video: { frameRate: { ideal: 30 } }
      })

      const mediaRecoder = new MediaRecorder(media, {
        mimeType: 'video/webm;codecs=vp8,opus'
      })

      mediaRecoder.start()

      const [video] = media.getVideoTracks()

      video.addEventListener('ended', () => {
        mediaRecoder.stop()
      })

      stop.addEventListener('click', () => {
        mediaRecoder.stop()
      })

      mediaRecoder.addEventListener('dataavailable', (e) => {
        const link = document.createElement('a')
        link.href = URL.createObjectURL(e.data)
        link.download = 'captura.webm'
        link.click()
      })
    })
  </script>
</body>
</html>